generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// admin role
enum Role {
  SUPER_ADMIN
  ADMIN
}

model Admin {
  id               Int               @id @default(autoincrement())
  name             String
  email            String            @unique
  password         String
  biometricsKey    String? // public key
  role             Role              @default(ADMIN)
  permissions      Json?
  roomReservations RoomReservation[]
  hallReservations HallReservation[]
  lawnReservations LawnReservation[]
  photoshootReservations PhotoshootReservation[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
}

enum MemberStatus {
  ACTIVE
  DEACTIVATED
  BLOCKED
}

model Member {
  Sno           Int          @id @default(autoincrement())
  Membership_No String       @unique
  Name          String
  Email         String?      @unique
  Contact_No    String?      @unique
  Status        MemberStatus @default(ACTIVE)
  Balance       Decimal?     @default(0.00) @db.Decimal(20, 2)
  Other_Details String?

  roomBookings        RoomBooking[]
  hallBookings        HallBooking[]
  lawnBookings        LawnBooking[]
  photoshootBookings  PhotoshootBooking[]

  sportsSubscriptions SportSubscription[]

  RoomHolding         roomHoldings[]
  hallHolding         hallHoldings[]
  lawnHolding         lawnHoldings[]

  notifications deliveredNotis[]

  totalBookings   Int       @default(0)
  drAmount        Decimal   @default(0.00) @db.Decimal(12, 2)
  crAmount        Decimal   @default(0.00) @db.Decimal(12, 2)

  bookingAmountPaid Int @default(0)
  bookingAmountDue  Int @default(0)
  bookingBalance   Int @default(0)

  lastBookingDate DateTime?

  vouchers PaymentVoucher[]

  otp       Int? //temp otp
  otpExpiry DateTime? //otp expiry time
  createdAt DateTime  @default(now())
  updatedat DateTime  @updatedAt
}

enum PaymentStatus {
  UNPAID
  HALF_PAID
  PAID
  TO_BILL
}

enum PaidBy {
  MEMBER
  GUEST
}

model RoomBooking {
  id            Int      @id @default(autoincrement())
  Membership_No String
  roomId        Int
  checkIn       DateTime
  checkOut      DateTime

  totalPrice    Decimal       @default(0.00) @db.Decimal(30, 2)
  paymentStatus PaymentStatus @default(UNPAID)
  pricingType   String
  paidAmount    Decimal       @default(0.00) @db.Decimal(30, 2)
  pendingAmount Decimal       @default(0.00) @db.Decimal(30, 2)

  numberOfAdults   Int @default(1)
  numberOfChildren Int @default(0)

  guestName    String? @db.Text
  guestContact String? @db.Text
  paidBy       PaidBy  @default(MEMBER)

  specialRequests String? @db.Text
  remarks         String? @db.Text

  refundAmount   Decimal @default(0.00) @db.Decimal(30, 2)
  refundReturned Boolean @default(false)

  member Member @relation(fields: [Membership_No], references: [Membership_No])
  room   Room   @relation(fields: [roomId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BookingOpt {
  MORNING
  EVENING
  NIGHT
}

model HallBooking {
  id             Int           @id @default(autoincrement())
  memberId       Int
  hallId         Int
  bookingDate    DateTime
  totalPrice     Decimal       @default(0.00) @db.Decimal(30, 2)
  paymentStatus  PaymentStatus @default(UNPAID)
  pricingType    String
  paidAmount     Decimal       @default(0.00) @db.Decimal(30, 2)
  pendingAmount  Decimal       @default(0.00) @db.Decimal(30, 2)
  eventType      String        @db.VarChar(255)
  numberOfGuests Int           @default(0)

  bookingTime BookingOpt @default(NIGHT)

  guestName    String? @db.Text
  guestContact String? @db.Text
  paidBy       PaidBy  @default(MEMBER)
  remarks      String? @db.Text

  refundAmount   Decimal @default(0.00) @db.Decimal(30, 2)
  refundReturned Boolean @default(false)

  member Member @relation(fields: [memberId], references: [Sno])
  hall   Hall   @relation(fields: [hallId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LawnBooking {
  id            Int           @id @default(autoincrement())
  memberId      Int
  lawnId        Int
  bookingDate   DateTime
  eventType     String?       @db.VarChar(255)
  bookingTime   BookingOpt    @default(NIGHT)
  guestsCount   Int
  totalPrice    Decimal       @default(0.00) @db.Decimal(30, 2)
  paymentStatus PaymentStatus @default(UNPAID)
  pricingType   String
  paidAmount    Decimal       @default(0.00) @db.Decimal(30, 2)
  pendingAmount Decimal       @default(0.00) @db.Decimal(30, 2)

  guestName    String? @db.Text
  guestContact String? @db.Text
  paidBy       PaidBy  @default(MEMBER)

  refundAmount   Decimal @default(0.00) @db.Decimal(30, 2)
  refundReturned Boolean @default(false)

  member Member @relation(fields: [memberId], references: [Sno])
  lawn   Lawn   @relation(fields: [lawnId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PhotoshootBooking {
  id            Int           @id @default(autoincrement())
  memberId      Int
  photoshootId  Int
  bookingDate   DateTime
  startTime     DateTime
  endTime       DateTime
  totalPrice    Decimal       @default(0.00) @db.Decimal(30, 2)
  paymentStatus PaymentStatus @default(UNPAID)
  pricingType   String
  paidAmount    Decimal       @default(0.00) @db.Decimal(30, 2)
  pendingAmount Decimal       @default(0.00) @db.Decimal(30, 2)


  guestName    String? @db.Text
  guestContact String? @db.Text
  paidBy       PaidBy  @default(MEMBER)

  refundAmount   Decimal @default(0.00) @db.Decimal(30, 2)
  refundReturned Boolean @default(false)

  member     Member     @relation(fields: [memberId], references: [Sno])
  photoshoot Photoshoot @relation(fields: [photoshootId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SportSubscription {
  id         Int        @id @default(autoincrement())
  memberId   Int
  sportId    Int
  chargeType ChargeType
  startDate  DateTime
  endDate    DateTime?
  totalPaid  Decimal    @default(0.00) @db.Decimal(30, 2)
  isActive   Boolean    @default(true)

  member Member @relation(fields: [memberId], references: [Sno])
  sport  Sport  @relation(fields: [sportId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PaymentVoucher {
  id         Int    @id @default(autoincrement())
  voucher_no String @unique @default(cuid())

  booking_type BookingType
  booking_id   Int

  membership_no String
  member        Member @relation(fields: [membership_no], references: [Membership_No], onDelete: Cascade)

  amount Decimal @db.Decimal(12, 2)

  // Payment origin & mode
  payment_mode PaymentMode @default(CASH)
  channel      Channel?

  // Gateway details (only for ONLINE)
  invoice_no     String? // KuickPay InvoiceNumber
  transaction_id String? // KuickPay TransactionId
  consumer_id    String? // KuickPay ConsumerId
  gateway_meta   Json? // Full webhook data from KuickPay

  remarks String?

  voucher_type VoucherType
  status       VoucherStatus @default(PENDING)

  issued_at DateTime @default(now())
  issued_by String? // admin name OR "system"

  @@index([booking_type, booking_id])
  @@index([membership_no])
  @@index([voucher_no])
}

enum Channel {
  ADMIN_PORTAL
  KUICKPAY
}

enum BookingType {
  ROOM
  HALL
  LAWN
  PHOTOSHOOT
}

enum PaymentMode {
  CASH
  ONLINE
}

enum VoucherType {
  FULL_PAYMENT
  HALF_PAYMENT
  REFUND
  ADJUSTMENT
}

enum VoucherStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// rooms types
model RoomType {
  id          Int     @id @unique() @default(autoincrement())
  type        String  @db.VarChar(50)
  priceMember Decimal @default(0.00) @db.Decimal(30, 2)
  priceGuest  Decimal @default(0.00) @db.Decimal(30, 2)

  images Json @default("[]")

  rooms     Room[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RoomReservation {
  id           Int      @id @default(autoincrement())
  roomId       Int
  room         Room     @relation(fields: [roomId], references: [id])
  reservedFrom DateTime
  reservedTo   DateTime
  reservedBy   Int
  admin        Admin    @relation(fields: [reservedBy], references: [id])
  remarks      String?  @db.Text
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([roomId])
  @@index([reservedFrom, reservedTo])
}

// rooms
model Room {
  id         Int      @id @unique @default(autoincrement())
  roomNumber String   @unique() @db.VarChar(50)
  roomTypeId Int
  roomType   RoomType @relation(fields: [roomTypeId], references: [id], onDelete: Cascade)

  description  String?           @db.VarChar(300)
  isActive     Boolean           @default(true)
  outOfOrders  RoomOutOfOrder[]
  isReserved   Boolean           @default(false)
  isBooked     Boolean           @default(false)
  bookings     RoomBooking[]
  reservations RoomReservation[]
  holdings roomHoldings[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model roomHoldings {
  id Int @id @unique @default(autoincrement())
  onHold       Boolean           @default(false)
  holdExpiry   DateTime?
  holdBy       String?
  holdMember   Member?           @relation(fields: [holdBy], references: [Membership_No])
  roomId Int
  room Room @relation(fields: [roomId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RoomOutOfOrder {
  id     Int  @id @unique @default(autoincrement())
  roomId Int
  room   Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  reason    String   @db.VarChar(300)
  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([roomId])
  @@index([startDate])
  @@index([endDate])
}

// halls
model Hall {
  id          Int     @id @unique() @default(autoincrement())
  name        String  @db.VarChar(50)
  description String? @db.Text

  capacity       Int
  chargesMembers Decimal @default(0.00) @db.Decimal(30, 2)
  chargesGuests  Decimal @default(0.00) @db.Decimal(30, 2)

  isActive    Boolean          @default(true)
  outOfOrders HallOutOfOrder[]

  images Json @default("[]")

  holdings hallHoldings[]

  isBooked Boolean       @default(false)
  bookings HallBooking[]

  isReserved   Boolean           @default(false)
  reservations HallReservation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model hallHoldings {
  id Int @id @unique @default(autoincrement())
  onHold       Boolean           @default(false)
  holdExpiry   DateTime?
  holdBy       String?
  holdMember   Member?           @relation(fields: [holdBy], references: [Membership_No])
  hallId Int
  hall Hall @relation(fields: [hallId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model HallOutOfOrder {
  id     Int  @id @unique @default(autoincrement())
  hallId Int
  hall   Hall @relation(fields: [hallId], references: [id], onDelete: Cascade)

  reason    String   @db.VarChar(300)
  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([hallId])
  @@index([startDate])
  @@index([endDate])
}

model HallReservation {
  id           Int      @id @default(autoincrement())
  hallId       Int
  hall         Hall     @relation(fields: [hallId], references: [id])
  reservedFrom DateTime
  reservedTo   DateTime
  reservedBy   Int
  timeSlot     String   @default("MORNING") @db.VarChar(20) // MORNING, EVENING, NIGHT
  admin        Admin    @relation(fields: [reservedBy], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([hallId])
  @@index([reservedFrom, reservedTo])
}

model LawnOutOfOrder {
  id     Int  @id @unique @default(autoincrement())
  lawnId Int
  lawn   Lawn @relation(fields: [lawnId], references: [id], onDelete: Cascade)

  reason    String   @db.VarChar(300)
  startDate DateTime
  endDate   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([lawnId])
  @@index([startDate])
  @@index([endDate])
}
model Lawn {
  id             Int          @id @default(autoincrement())
  description    String       @db.VarChar(200)
  lawnCategoryId Int
  lawnCategory   LawnCategory @relation(fields: [lawnCategoryId], references: [id])
  minGuests      Int?         @default(0)
  maxGuests      Int          @default(0)
  memberCharges  Decimal      @default(0.00) @db.Decimal(30, 2)
  guestCharges   Decimal      @default(0.00) @db.Decimal(30, 2)
  isActive       Boolean      @default(true)
  isOutOfService Boolean      @default(false)

  outOfOrders LawnOutOfOrder[]
  holdings lawnHoldings[]

  isBooked     Boolean           @default(false)
  bookings     LawnBooking[]
  reservations LawnReservation[]
  isReserved   Boolean           @default(false)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
}
model lawnHoldings {
  id Int @id @unique @default(autoincrement())
  onHold       Boolean           @default(false)
  holdExpiry   DateTime?
  holdBy       String?
  holdMember   Member?           @relation(fields: [holdBy], references: [Membership_No])
  lawnId Int
  lawn Lawn @relation(fields: [lawnId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LawnCategory {
  id        Int      @unique @default(autoincrement())
  category  String   @db.VarChar(200)
  images    Json     @default("[]")
  lawns     Lawn[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LawnReservation {
  id           Int      @id @default(autoincrement())
  lawnId       Int
  lawn         Lawn     @relation(fields: [lawnId], references: [id])
  reservedFrom DateTime
  reservedTo   DateTime
  timeSlot     String   @default("MORNING") @db.VarChar(20) // MORNING, EVENING, NIGHT
  reservedBy   Int
  admin        Admin    @relation(fields: [reservedBy], references: [id])
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([lawnId])
  @@index([reservedFrom, reservedTo])
}

model PhotoshootReservation {
  id           Int        @id @default(autoincrement())
  photoshootId Int
  photoshoot   Photoshoot @relation(fields: [photoshootId], references: [id])
  reservedFrom DateTime
  reservedTo   DateTime
  timeSlot     String     @default("MORNING") @db.VarChar(20)
  reservedBy   Int
  admin        Admin      @relation(fields: [reservedBy], references: [id])
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([photoshootId])
  @@index([reservedFrom, reservedTo])
}

// photoshoot
model Photoshoot {
  id          Int    @id @unique @default(autoincrement())
  description String @db.VarChar(200)

  memberCharges Decimal @default(0.00) @db.Decimal(30, 2)
  guestCharges  Decimal @default(0.00) @db.Decimal(30, 2)
  isActive Boolean @default(true)
  isBooked   Boolean             @default(false)
  bookings   PhotoshootBooking[]
  reservations PhotoshootReservation[]
  isReserved   Boolean             @default(false)
  // onHold     Boolean             @default(false)
  // holdBy     String?
  // holdMember Member?             @relation(fields: [holdBy], references: [Membership_No])
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
}

// sports
enum ChargeType {
  PER_DAY
  PER_MONTH
  PER_GAME
  PER_HOUR
}

model Sport {
  id          Int     @unique @default(autoincrement())
  activity    String  @db.VarChar(100)
  description String? @db.VarChar(300)
  isActive    Boolean @default(true)
  images      Json    @default("[]") // Array of image URLs, max 5

  // Timing for Gents: JSON object with each day of the week
  // Format: { "monday": { "open": "09:00 AM", "close": "05:00 PM", "isClosed": false }, ... }
  timing Json? @default("{}")

  // Timing for Ladies: JSON object with each day of the week
  timingLadies Json? @default("{}")

  // Dress Code (rich text)
  dressCodeDos   String? @db.LongText
  dressCodeDonts String? @db.LongText

  // General Do's and Don'ts (rich text)
  dos   String? @db.LongText
  donts String? @db.LongText

  subscriptions SportSubscription[]

  sportCharge SportCharge[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model SportCharge {
  id         Int        @unique @default(autoincrement())
  activityId Int
  chargeType ChargeType

  memberCharges         Decimal? @default(0.00) @db.Decimal(30, 2)
  spouseCharges         Decimal? @default(0.00) @db.Decimal(30, 2)
  childrenCharges       Decimal? @default(0.00) @db.Decimal(30, 2)
  guestCharges          Decimal? @default(0.00) @db.Decimal(30, 2)
  affiliatedClubCharges Decimal? @default(0.00) @db.Decimal(30, 2)

  activity  Sport    @relation(fields: [activityId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// affiliated clubs
enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}


model AffiliatedClub {
  id          Int     @id @default(autoincrement())
  name        String  @db.VarChar(200)
  location    String? @db.VarChar(300)
  contactNo   String? @db.VarChar(50)
  email       String? @db.VarChar(100)
  description String? @db.Text
  image       String?
  isActive    Boolean @default(true)

  requests AffiliatedClubRequest[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AffiliatedClubRequest {
  id               Int           @id @default(autoincrement())
  membershipNo     String
  affiliatedClubId Int
  affiliatedClub   AffiliatedClub @relation(fields: [affiliatedClubId], references: [id], onDelete: Cascade)


  requestedDate DateTime  

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([membershipNo])
  @@index([affiliatedClubId])
}

// Content Management

model Event {
  id          Int      @id @default(autoincrement())
  title       String
  images      Json     @default("[]") // Array of image URLs
  startDate   DateTime
  endDate     DateTime
  time        String?
  venue       String?
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ClubRule {
  id        Int      @id @default(autoincrement())
  content   String   @db.LongText // Rich text content
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Announcement {
  id          Int      @id @default(autoincrement())
  title       String
  description String?  @db.Text
  date        DateTime
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AboutUs {
  id        Int      @id @default(autoincrement())
  clubInfo  String   @db.LongText
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClubHistory {
  id          Int      @id @default(autoincrement())
  description String   @db.Text
  image       String?  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model PromotionalAd {
  id          Int      @id @default(autoincrement())
  title       String?
  description String?  @db.Text
  image       String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model deliveredNotis{
  id          Int      @id @default(autoincrement())
  notificationId Int
  notification Notification @relation(fields: [notificationId], references: [id])
  seen Boolean @default(false)
  member Int
  deliveredTo Member @relation(fields: [member], references: [Sno])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Notification {
  id          Int      @id @default(autoincrement())
  title       String
  description String?  @db.Text
  delivered   Boolean  @default(false)
  deliveries deliveredNotis[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

